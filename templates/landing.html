{% extends "base.html" %}

{% block title %}ãƒ›ãƒ¼ãƒ  - {{ app_name }}{% endblock %}

{% block head_extra %}
<style>
    .landing-hero {
        text-align: center;
        padding: 80px 20px;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        border-radius: 15px;
        margin-bottom: 40px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .landing-hero h1 {
        font-size: 3.5rem;
        font-weight: 900;
        margin-bottom: 20px;
        color: #2c3e50;
        text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
    }

    .landing-hero p {
        font-size: 1.25rem;
        color: #555;
        max-width: 600px;
        margin: 0 auto 30px;
        line-height: 1.6;
    }

    .feature-card {
        border: none;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        background: #fff;
        border-radius: 10px;
        overflow: hidden;
    }

    .feature-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
    }

    .feature-icon {
        font-size: 1.4rem;
        margin-bottom: 5px;
        color: #4a90e2;
    }

    .cta-button {
        padding: 15px 40px;
        font-size: 1.2rem;
        border-radius: 50px;
        font-weight: bold;
        transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(74, 144, 226, 0.4);
    }

    .cta-button:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 20px rgba(74, 144, 226, 0.6);
    }

    .section-title {
        text-align: center;
        margin-bottom: 15px;
        font-weight: 800;
        color: #34495e;
        position: relative;
        padding-bottom: 10px;
    }

    .section-title::after {
        content: '';
        display: block;
        width: 60px;
        height: 4px;
        background: #4a90e2;
        margin: 10px auto 0;
        border-radius: 2px;
    }
</style>
{% endblock %}

{% block content %}
<div class="landing-hero">
    <h1>{{ app_name }}</h1>
    <p>
        ç¤¾ä¼šç§‘å­¦ç¿’ã®æ–°ã—ã„ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰
    </p>
    <div class="d-flex justify-content-center gap-3">
        <a href="{{ url_for('login_page') }}" class="btn btn-primary cta-button">
            <i class="fas fa-sign-in-alt me-2"></i>ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦å­¦ç¿’ã‚’å§‹ã‚ã‚‹
        </a>
        <a href="{{ url_for('columns_page') }}" class="btn btn-outline-dark cta-button"
            style="background: rgba(255,255,255,0.8);">
            <i class="fas fa-book-open me-2"></i>ã‚³ãƒ©ãƒ ã‚’èª­ã‚€
        </a>
    </div>
</div>

<div class="container py-2">
    <h2 class="section-title" style="margin-bottom: 10px; font-size: 1.3rem;">ä¸»ãªæ©Ÿèƒ½</h2>
    <div class="row g-2">
        <div class="col-6 col-md-3">
            <div class="card border-0 shadow-sm py-2 px-2 text-center"
                style="border-radius: 8px; min-height: auto !important;">
                <div style="font-size: 1.5rem; color: #4a90e2;"><i class="fas fa-pen-fancy"></i></div>
                <div class="fw-bold" style="font-size: 0.85rem;">è«–è¿°å•é¡Œæ¼”ç¿’</div>
                <div class="text-muted" style="font-size: 0.75rem;">AIã®æ·»å‰Šã§è¨˜è¿°åŠ›UP</div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card border-0 shadow-sm py-2 px-2 text-center"
                style="border-radius: 8px; min-height: auto !important;">
                <div style="font-size: 1.5rem; color: #4a90e2;"><i class="fas fa-history"></i></div>
                <div class="fw-bold" style="font-size: 0.85rem;">è±Šå¯Œãªã‚³ãƒ©ãƒ </div>
                <div class="text-muted" style="font-size: 0.75rem;">æ­´å²ã®èƒŒæ™¯ã‚’æ·±ãå­¦ç¿’</div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card border-0 shadow-sm py-2 px-2 text-center"
                style="border-radius: 8px; min-height: auto !important;">
                <div style="font-size: 1.5rem; color: #4a90e2;"><i class="fas fa-check-circle"></i></div>
                <div class="fw-bold" style="font-size: 0.85rem;">ä¸€å•ä¸€ç­”</div>
                <div class="text-muted" style="font-size: 0.75rem;">ã‚¹ã‚­ãƒæ™‚é–“ã«æœ€é©</div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card border-0 shadow-sm py-2 px-2 text-center"
                style="border-radius: 8px; min-height: auto !important;">
                <div style="font-size: 1.5rem; color: #4a90e2;"><i class="fas fa-chart-line"></i></div>
                <div class="fw-bold" style="font-size: 0.85rem;">é€²æ—ç®¡ç†</div>
                <div class="text-muted" style="font-size: 0.75rem;">å­¦ç¿’ã‚’ã‚°ãƒ©ãƒ•ã§å¯è¦–åŒ–</div>
            </div>
        </div>
    </div>

    <!-- ã‚µãƒ³ãƒ—ãƒ«ã‚¯ã‚¤ã‚ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="container py-5 mt-4">
        <h2 class="section-title">ã‚µãƒ³ãƒ—ãƒ«ã‚¯ã‚¤ã‚º</h2>
        <p class="text-center text-muted mb-4">ãƒ­ã‚°ã‚¤ãƒ³ä¸è¦ã§10å•ã®ã‚¯ã‚¤ã‚ºã«æŒ‘æˆ¦</p>

        <div class="row justify-content-center">
            <div class="col-lg-8">
                <!-- ã‚¯ã‚¤ã‚ºé–‹å§‹å‰ -->
                <div id="quiz-start" class="card shadow-sm p-5 text-center">
                    <div class="mb-4">
                        <i class="fas fa-question-circle text-primary" style="font-size: 4rem;"></i>
                    </div>
                    <h3 class="h4 mb-3">ä¸€å•ä¸€ç­”</h3>
                    <p class="text-muted mb-4">ãƒ©ãƒ³ãƒ€ãƒ ã§10å•å‡ºé¡Œã•ã‚Œã¾ã™ã€‚</p>
                    <button id="startQuizBtn" class="btn btn-primary btn-lg px-5" onclick="startSampleQuiz()">
                        <i class="fas fa-play me-2"></i>é–‹å§‹
                    </button>
                </div>

                <!-- ã‚¯ã‚¤ã‚ºä¸­ -->
                <div id="quiz-area" class="card shadow-sm" style="display: none;">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <span><i class="fas fa-question-circle me-2"></i>ã‚µãƒ³ãƒ—ãƒ«ã‚¯ã‚¤ã‚º</span>
                        <span id="quiz-progress" class="badge bg-light text-dark">1 / 10</span>
                    </div>
                    <div class="card-body p-4">
                        <div id="quiz-question" class="mb-4">
                            <p class="h5 mb-2" id="question-text"></p>
                            <p class="text-muted small mb-0" id="question-category"></p>
                        </div>

                        <div id="quiz-choices" class="d-grid gap-2">
                            <!-- é¸æŠè‚¢ãƒœã‚¿ãƒ³ãŒJSã§å‹•çš„ã«æŒ¿å…¥ã•ã‚Œã‚‹ -->
                        </div>
                    </div>
                </div>

                <!-- ã‚¯ã‚¤ã‚ºçµæœ -->
                <div id="quiz-result" class="card shadow-sm p-5 text-center" style="display: none;">
                    <div class="mb-4">
                        <i class="fas fa-trophy text-warning" style="font-size: 4rem;"></i>
                    </div>
                    <h3 class="h4 mb-3">ã‚¯ã‚¤ã‚ºå®Œäº†ï¼</h3>
                    <p class="display-4 fw-bold text-primary mb-3" id="result-score">0 / 10</p>
                    <p class="text-muted mb-4" id="result-message"></p>
                    <div class="d-flex justify-content-center gap-3 flex-wrap">
                        <button class="btn btn-outline-primary" onclick="startSampleQuiz()">
                            <i class="fas fa-redo me-2"></i>ã‚‚ã†ä¸€åº¦
                        </button>
                        <a href="{{ url_for('login_page') }}" class="btn btn-primary">
                            <i class="fas fa-sign-in-alt me-2"></i>ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦å­¦ç¿’
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container py-5 bg-light rounded-3 mt-5">
        <div class="row align-items-center">
            <div class="col-md-6 text-center text-md-start px-5">
                <h2 class="fw-bold mb-3">ä»Šã™ãå§‹ã‚ã‚ˆã†</h2>
                <p class="lead text-muted mb-4">
                    {{ app_name }}ã§ã€æ•™é¤Šã‚’ãƒ¯ãƒ³ãƒ©ãƒ³ã‚¯ã‚¢ãƒƒãƒ—ã•ã›ã¾ã—ã‚‡ã†ã€‚
                </p>
            </div>
            <div class="col-md-6 text-center">
                <a href="{{ url_for('columns_page') }}" class="btn btn-warning btn-lg px-5 py-3 fw-bold shadow-sm">
                    <i class="fas fa-arrow-right me-2"></i>å…¬é–‹ä¸­ã®ã‚³ãƒ©ãƒ ã‚’è¦‹ã‚‹
                </a>
            </div>
        </div>
    </div>

    <style>
        /* 4æŠãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .choice-btn {
            text-align: left;
            padding: 12px 20px;
            font-size: 1rem;
            border: 2px solid #dee2e6;
            background: #fff;
            transition: all 0.2s;
        }

        .choice-btn:hover:not(:disabled) {
            border-color: #4a90e2;
            background: #f8f9fa;
        }

        .choice-btn.correct {
            border-color: #28a745 !important;
            background: #d4edda !important;
            color: #155724 !important;
        }

        .choice-btn.incorrect {
            border-color: #dc3545 !important;
            background: #f8d7da !important;
            color: #721c24 !important;
        }

        .choice-btn:disabled {
            opacity: 0.8;
        }

        .feedback-icon {
            float: right;
            font-size: 1.2em;
        }
    </style>

    <script>
        // ã‚µãƒ³ãƒ—ãƒ«ã‚¯ã‚¤ã‚ºç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆ4æŠå½¢å¼ï¼‰
        let sampleQuizData = {
            questions: [],
            currentIndex: 0,
            correctCount: 0
        };

        async function startSampleQuiz() {
            try {
                document.getElementById('startQuizBtn').innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>èª­ã¿è¾¼ã¿ä¸­...';
                document.getElementById('startQuizBtn').disabled = true;

                const response = await fetch('/api/sample-quiz');
                const data = await response.json();

                if (data.error) {
                    alert('å•é¡Œã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + data.error);
                    document.getElementById('startQuizBtn').innerHTML = '<i class="fas fa-play me-2"></i>é–‹å§‹';
                    document.getElementById('startQuizBtn').disabled = false;
                    return;
                }

                sampleQuizData.questions = data.questions;
                sampleQuizData.currentIndex = 0;
                sampleQuizData.correctCount = 0;

                document.getElementById('quiz-start').style.display = 'none';
                document.getElementById('quiz-result').style.display = 'none';
                document.getElementById('quiz-area').style.display = 'block';

                showQuestion();

            } catch (error) {
                console.error('Quiz load error:', error);
                alert('å•é¡Œã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
                document.getElementById('startQuizBtn').innerHTML = '<i class="fas fa-play me-2"></i>é–‹å§‹';
                document.getElementById('startQuizBtn').disabled = false;
            }
        }

        function showQuestion() {
            const q = sampleQuizData.questions[sampleQuizData.currentIndex];
            document.getElementById('question-text').textContent = q.question;
            document.getElementById('question-category').textContent = q.category ? `ğŸ“š ${q.category}` : '';
            document.getElementById('quiz-progress').textContent = `${sampleQuizData.currentIndex + 1} / ${sampleQuizData.questions.length}`;

            // é¸æŠè‚¢ã‚’ç”Ÿæˆï¼ˆdata-indexå±æ€§ã§ã‚¯ãƒªãƒƒã‚¯æ™‚ã«å‚ç…§ï¼‰
            const choicesContainer = document.getElementById('quiz-choices');
            choicesContainer.innerHTML = q.choices.map((choice, index) =>
                `<button class="btn choice-btn" data-index="${index}">${choice}</button>`
            ).join('');

            // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒã‚¤ãƒ³ãƒ‰
            choicesContainer.querySelectorAll('.choice-btn').forEach((btn, index) => {
                btn.addEventListener('click', function () {
                    handleSampleAnswer(this, q.choices[index]);
                });
            });
        }

        function handleSampleAnswer(button, selectedChoice) {
            const q = sampleQuizData.questions[sampleQuizData.currentIndex];
            const correctAnswer = q.answer;
            const isCorrect = selectedChoice === correctAnswer;

            // å…¨ã¦ã®ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            document.querySelectorAll('.choice-btn').forEach(btn => btn.disabled = true);

            if (isCorrect) {
                sampleQuizData.correctCount++;
                button.classList.add('correct');
                button.innerHTML += ' <i class="fas fa-check-circle feedback-icon"></i>';
            } else {
                button.classList.add('incorrect');
                button.innerHTML += ' <i class="fas fa-times-circle feedback-icon"></i>';
                // æ­£è§£ã®é¸æŠè‚¢ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                document.querySelectorAll('.choice-btn').forEach(btn => {
                    if (btn.textContent.trim() === correctAnswer || btn.textContent.includes(correctAnswer)) {
                        btn.classList.add('correct');
                    }
                });
            }

            // 1.5ç§’å¾Œã«æ¬¡ã®å•é¡Œã¸
            setTimeout(() => {
                sampleQuizData.currentIndex++;
                if (sampleQuizData.currentIndex >= sampleQuizData.questions.length) {
                    showResult();
                } else {
                    showQuestion();
                }
            }, 1200);
        }

        function showResult() {
            document.getElementById('quiz-area').style.display = 'none';
            document.getElementById('quiz-result').style.display = 'block';

            const total = sampleQuizData.questions.length;
            const correct = sampleQuizData.correctCount;
            const percentage = Math.round((correct / total) * 100);

            document.getElementById('result-score').textContent = `${correct} / ${total}`;

            let message = '';
            if (percentage === 100) {
                message = 'ğŸ‰ ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆï¼ç´ æ™´ã‚‰ã—ã„ï¼';
            } else if (percentage >= 80) {
                message = 'ğŸ‘ ã™ã”ã„ï¼ã‚ˆãã§ãã¾ã—ãŸï¼';
            } else if (percentage >= 60) {
                message = 'ğŸ‘ ã„ã„èª¿å­ï¼ã‚‚ã†å°‘ã—é ‘å¼µã‚ã†ï¼';
            } else if (percentage >= 40) {
                message = 'ğŸ“š ã‚‚ã£ã¨å¾©ç¿’ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼';
            } else {
                message = 'ğŸ’ª ä¸€ç·’ã«é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼';
            }
            document.getElementById('result-message').textContent = message;

            // ãƒœã‚¿ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('startQuizBtn').innerHTML = '<i class="fas fa-play me-2"></i>é–‹å§‹';
            document.getElementById('startQuizBtn').disabled = false;
        }
    </script>
    {% endblock %}

    {% block footer %}
    <footer class="footer mt-5 py-4 bg-light border-top">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6 text-center text-md-start">
                    <div class="footer-text">
                        Â© 2025 {{ app_name }}. All rights reserved.
                    </div>
                </div>
                <div class="col-md-6 text-center text-md-end">
                    <div class="footer-links">
                        <a href="{{ url_for('privacy_policy') }}" class="text-muted small text-decoration-none me-3">
                            ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼
                        </a>
                        <a href="{{ url_for('terms_of_service') }}" class="text-muted small text-decoration-none">
                            åˆ©ç”¨è¦ç´„
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    {% endblock %}
    {% block info_icon %}{% endblock %}