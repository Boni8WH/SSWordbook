{% extends "base.html" %}

{% block title %}ç®¡ç†è€…ãƒšãƒ¼ã‚¸ - ä¸–ç•Œå²å˜èªå¸³{% endblock %}

{% block content %}
<div class="admin-container">
    <h2>ç®¡ç†è€…ãƒšãƒ¼ã‚¸</h2>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <ul class="flashes">
                {% for category, message in messages %}
                    <li class="{{ category }}">{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}

    <!-- ã‚¢ãƒ—ãƒªæƒ…å ±ç®¡ç†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <section id="admin-app-info-management">
        <h3>ğŸ“± ã‚¢ãƒ—ãƒªæƒ…å ±ç®¡ç†</h3>
        <p>ã‚¢ãƒ—ãƒªã®è¡¨ç¤ºåã€æ›´æ–°å†…å®¹ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ãªã©ã‚’ç·¨é›†ã§ãã¾ã™ã€‚</p>
        
        <div class="admin-panel" style="background-color: #e8f4fd; border-left: 5px solid #3498db;">
            <h4>ç¾åœ¨ã®ã‚¢ãƒ—ãƒªæƒ…å ±</h4>
            <div class="row">
                <div class="col-md-6">
                    <p><strong>ã‚¢ãƒ—ãƒªå:</strong> {{ app_info.app_name if app_info else 'ä¸–ç•Œå²å˜èªå¸³' }}</p>
                    <p><strong>ãƒãƒ¼ã‚¸ãƒ§ãƒ³:</strong> {{ app_info.version if app_info else '1.0.0' }}</p>
                    <p><strong>æœ€çµ‚æ›´æ–°æ—¥:</strong> {{ app_info.last_updated_date if app_info else '2025å¹´6æœˆ15æ—¥' }}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>æ›´æ–°å†…å®¹:</strong></p>
                    <div style="background-color: white; padding: 10px; border-radius: 5px; border: 1px solid #ddd; font-size: 0.9em;">
                        {{ app_info.update_content if app_info else 'ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸã€‚' }}
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 15px;">
                <a href="{{ url_for('admin_app_info') }}" class="btn btn-primary">
                    <i class="fas fa-edit"></i> ã‚¢ãƒ—ãƒªæƒ…å ±ã‚’ç·¨é›†
                </a>
                <a href="{{ url_for('index') }}" class="btn btn-outline-info" target="_blank">
                    <i class="fas fa-external-link-alt"></i> å®Ÿéš›ã®è¡¨ç¤ºã‚’ç¢ºèª
                </a>
            </div>
        </div>
    </section>

    <hr>

    <section id="admin-user-management">
        <h3>ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</h3>
        <p>ç™»éŒ²æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼: {{ users|length }}äºº</p>

        <h4>å€‹åˆ¥ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ </h4>
        <form action="{{ url_for('admin_add_user') }}" method="POST" class="add-user-form">
            <div class="input-group">
                <label for="new_room_number">éƒ¨å±‹ç•ªå·:</label>
                <input type="text" id="new_room_number" name="room_number" required>
            </div>
            <div class="input-group">
                <label for="new_room_password">å…¥å®¤ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰:</label>
                <input type="password" id="new_room_password" name="room_password" required>
            </div>
            <div class="input-group">
                <label for="new_student_id">å‡ºå¸­ç•ªå·:</label>
                <input type="text" id="new_student_id" name="student_id" required>
            </div>
            <div class="input-group">
                <label for="new_individual_password">å€‹åˆ¥ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰:</label>
                <input type="password" id="new_individual_password" name="individual_password" required>
            </div>
            <div class="input-group">
                <label for="new_username">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå:</label>
                <input type="text" id="new_username" name="username" required>
                <small class="form-text text-muted">â€»åŒä¸€äººç‰©ãŒè¤‡æ•°ã®éƒ¨å±‹ã«å‚åŠ ã™ã‚‹å ´åˆã€åŒã˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåã§ã‚‚ç™»éŒ²å¯èƒ½ã§ã™</small>
            </div>
            <button type="submit" class="btn btn-primary">ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ </button>
        </form>

        <h4>CSVä¸€æ‹¬ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ </h4>
        <div style="background-color: #e8f4fd; border: 1px solid #b3d7ff; border-radius: 5px; padding: 15px; margin-bottom: 20px;">
            <p><strong>CSVãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼è¦ä»¶:</strong></p>
            <ul>
                <li>ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ: éƒ¨å±‹ç•ªå·,å…¥å®¤ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰,å‡ºå¸­ç•ªå·,å€‹åˆ¥ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰,ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå</li>
                <li>æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°: UTF-8</li>
                <li>ä¾‹: 101,password123,001,student001,æˆå¯Œå…µåº«èŒ‚å®‰</li>
                <li>åŒä¸€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåã®ç™»éŒ²ã‚‚å¯èƒ½ã§ã™ï¼ˆåŒä¸€äººç‰©ãŒè¤‡æ•°éƒ¨å±‹ã«å‚åŠ ã™ã‚‹å ´åˆï¼‰</li>
            </ul>
            <a href="{{ url_for('download_users_template_csv') }}" class="btn btn-outline-info btn-sm">
                <i class="fas fa-download"></i> ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            </a>
        </div>

        <form action="{{ url_for('admin_upload_users') }}" method="POST" enctype="multipart/form-data" class="upload-form">
            <div class="input-group">
                <label for="users_csv_file">ãƒ¦ãƒ¼ã‚¶ãƒ¼CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ:</label>
                <input type="file" id="users_csv_file" name="file" accept=".csv" required>
            </div>
            <button type="submit" class="btn btn-success">
                <i class="fas fa-upload"></i> CSVä¸€æ‹¬ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ 
            </button>
        </form>

        <h4>ç™»éŒ²æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</h4>
        <!-- ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½ä»˜ããƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆ -->
        <div class="table-controls mb-3">
            <div class="row">
                <div class="col-md-6">
                    <label for="roomSortSelect">éƒ¨å±‹ã§ã‚½ãƒ¼ãƒˆ:</label>
                    <select id="roomSortSelect" class="form-control form-control-sm">
                        <option value="">å…¨ã¦ã®éƒ¨å±‹</option>
                        {% set room_numbers = [] %}
                        {% for user in users %}
                            {% if user.room_number not in room_numbers and user.room_number != 'ADMIN' %}
                                {% set _ = room_numbers.append(user.room_number) %}
                            {% endif %}
                        {% endfor %}
                        {% for room_num in room_numbers|sort %}
                            <option value="{{ room_num }}">éƒ¨å±‹ {{ room_num }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="userSearchInput">ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢:</label>
                    <input type="text" id="userSearchInput" class="form-control form-control-sm" placeholder="åå‰ã€å‡ºå¸­ç•ªå·ã§æ¤œç´¢...">
                </div>
            </div>
        </div>

        <!-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ãªãƒ†ãƒ¼ãƒ–ãƒ«ã‚³ãƒ³ãƒ†ãƒŠ -->
        <div class="scrollable-table-container">
            <div class="table-responsive">
                <table class="table table-striped user-list-table" id="userTable">
                    <thead class="table-dark sticky-header">
                        <tr>
                            <th>ID</th>
                            <th>éƒ¨å±‹ <i class="fas fa-sort sort-icon" data-column="room" style="cursor: pointer;"></i></th>
                            <th>å‡ºå¸­ç•ªå·</th>
                            <th>ç¾åœ¨ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå <i class="fas fa-sort sort-icon" data-column="name" style="cursor: pointer;"></i></th>
                            <th>æœ€åˆã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå</th>
                            <th>å¤‰æ›´æ—¥æ™‚</th>
                            <th>æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³ <i class="fas fa-sort sort-icon" data-column="login" style="cursor: pointer;"></i></th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="userTableBody">
                        {% for user in users %}
                        {% if user.username != 'admin' %}
                        <tr data-room="{{ user.room_number }}" data-name="{{ user.username|lower }}" data-student="{{ user.student_id|lower }}">
                            <td>{{ user.id }}</td>
                            <td><span class="badge bg-secondary">{{ user.room_number }}</span></td>
                            <td>{{ user.student_id }}</td>
                            <td>
                                {{ user.username }}
                                {% if user.original_username and user.original_username != user.username %}
                                <span class="badge bg-warning text-dark ms-1">
                                    <i class="fas fa-edit"></i> å¤‰æ›´æ¸ˆã¿
                                </span>
                                {% endif %}
                            </td>
                            <td>
                                {% if user.original_username and user.original_username != user.username %}
                                <span class="text-muted">{{ user.original_username }}</span>
                                {% else %}
                                <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if user.username_changed_at %}
                                <small>{{ user.username_changed_at or '-' }}</small>
                                {% else %}
                                <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                            <td>{{ user.last_login | to_jst if user.last_login else 'æœªãƒ­ã‚°ã‚¤ãƒ³' }}</td>
                            <td>
                                <button class="btn btn-danger btn-sm delete-user-btn"
                                        data-user-id="{{ user.id }}"
                                        data-username="{{ user.username }}"
                                        data-room="{{ user.room_number }}">å‰Šé™¤</button>
                            </td>
                        </tr>
                        {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <hr>

    <section id="admin-data-migration">
        <h3>ğŸ”§ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†</h3>
        <p>å­¦ç¿’å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ç¢ºèªã¨ãƒ‡ãƒ¼ã‚¿ç§»è¡Œã‚’è¡Œã„ã¾ã™ã€‚</p>

        <div class="admin-panel" style="background-color: #e8f5e8; border-left: 5px solid #28a745; margin-top: 20px;">
            <h4>ğŸ”§ãƒ‡ãƒ¼ã‚¿ä¿®æ­£</h4>
            <p>å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å­¦ç¿’å±¥æ­´ã‚’æ–°ã—ã„IDå½¢å¼ã«çµ±ä¸€ã—ã€ãƒãƒƒãƒã—ãªã„å•é¡Œã‚’è§£æ±ºã—ã¾ã™ã€‚<br>
            <strong>âš ï¸ æ³¨æ„ï¼š</strong>ã“ã®æ“ä½œã¯å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å­¦ç¿’å±¥æ­´ã«å½±éŸ¿ã—ã€å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚</p>
            
            <div style="margin-top: 15px;">
                <form action="{{ url_for('admin_fix_all_data') }}" method="POST" style="display: inline;" 
                    onsubmit="return confirm('å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ä¿®æ­£ã—ã¾ã™ã‹ï¼Ÿ\n\nâš ï¸ ã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚\nâš ï¸ ã™ã¹ã¦ã®å­¦ç¿’å±¥æ­´ãŒæ–°ã—ã„å½¢å¼ã«å¤‰æ›ã•ã‚Œã¾ã™ã€‚\nâš ï¸ å‡¦ç†ã«æ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚')">
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-wrench"></i> ğŸ”§ å…¨ãƒ‡ãƒ¼ã‚¿å®Œå…¨ä¿®æ­£
                    </button>
                </form>
                
                <a href="{{ url_for('admin_debug_progress') }}" class="btn btn-info" target="_blank" style="margin-left: 10px;">
                    <i class="fas fa-chart-line"></i> ğŸ“Š ä¿®æ­£å‰ã®çŠ¶æ…‹ç¢ºèª
                </a>
            </div>
        </div>
    </section>

    <hr>

    <!-- éƒ¨å±‹ã”ã¨CSVãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <section id="admin-csv-management">
        <h3>ğŸ“ éƒ¨å±‹ã”ã¨CSVãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†</h3>
        <p>å„éƒ¨å±‹ã§ä½¿ç”¨ã™ã‚‹å˜èªå¸³CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’å€‹åˆ¥ã«è¨­å®šã§ãã¾ã™ã€‚ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®words.csvãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚</p>

        <h4>CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h4>
        <div style="background-color: #e8f4fd; border: 1px solid #b3d7ff; border-radius: 5px; padding: 15px; margin-bottom: 20px;">
            <p><strong>CSVãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼è¦ä»¶:</strong></p>
            <ul>
                <li>ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ: chapter, number, category, question, answer, enabled</li>
                <li>enabledåˆ—: 1ï¼ˆæœ‰åŠ¹ï¼‰ã¾ãŸã¯0ï¼ˆç„¡åŠ¹ï¼‰</li>
                <li>æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°: UTF-8</li>
                <li>ãƒ•ã‚¡ã‚¤ãƒ«åã¯å…ƒã®åå‰ã®ã¾ã¾ä¿å­˜ã•ã‚Œã¾ã™</li>
            </ul>
        </div>
        
        <form action="{{ url_for('admin_upload_room_csv') }}" method="POST" enctype="multipart/form-data" class="upload-form">
            <div class="input-group">
                <label for="room_csv_file">CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ:</label>
                <input type="file" id="room_csv_file" name="file" accept=".csv" required>
                <small class="form-text text-muted">ï¼Šãƒ•ã‚¡ã‚¤ãƒ«åã¯åŠè§’è‹±æ•°å­—ï¼Š</small>
            </div>
            <button type="submit" class="btn btn-success">CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
        </form>

        <h4>ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿CSVãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§</h4>
        <div id="csv-files-list">
            <div class="d-flex gap-2 mb-3">
                <button class="btn btn-info btn-sm" onclick="loadCsvFilesList()">
                    <i class="fas fa-sync-alt"></i> ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’æ›´æ–°
                </button>
            </div>
            <!-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ãªCSVãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆ -->
            <div class="scrollable-table-container">
                <div id="csv-files-container" style="margin-top: 15px;">
                    <p class="text-info">ğŸ“‹ ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
                </div>
            </div>
        </div>
    </section>

    <hr>

    <section id="admin-room-settings">
        <h3>ğŸ  éƒ¨å±‹ã”ã¨ã®è¨­å®šç®¡ç†</h3>
        <p>å„éƒ¨å±‹ã®å­¦ç¿’ç¯„å›²ã¨CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¨­å®šã—ã¾ã™ã€‚</p>

        <!-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ãªéƒ¨å±‹è¨­å®šãƒ†ãƒ¼ãƒ–ãƒ« -->
        <div class="scrollable-table-container">
            <div class="table-responsive">
                <table class="table table-striped room-setting-table">
                    <thead class="table-dark sticky-header">
                        <tr>
                            <th>éƒ¨å±‹ç•ªå·</th>
                            <th>æœ€å¤§å˜å…ƒç•ªå·</th>
                            <th>ä½¿ç”¨CSVãƒ•ã‚¡ã‚¤ãƒ«</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% set unique_room_numbers = [] %}
                        {% for user in users %}
                            {% if user.room_number not in unique_room_numbers and user.room_number != 'ADMIN' %}
                                {% set _ = unique_room_numbers.append(user.room_number) %}
                            {% endif %}
                        {% endfor %}
                        
                        {% for setting in room_max_unit_settings.keys() %}
                            {% if setting not in unique_room_numbers and setting != 'ADMIN' %}
                                {% set _ = unique_room_numbers.append(setting) %}
                            {% endif %}
                        {% endfor %}

                        {% for room_num in unique_room_numbers|sort %}
                        <tr>
                            <td><strong>{{ room_num }}</strong></td>
                            <td>
                                <input type="text"
                                       id="maxUnit_{{ room_num }}"
                                       value="{{ room_max_unit_settings.get(room_num, '9999') }}"
                                       class="form-control unit-setting-input"
                                       data-room-number="{{ room_num }}"
                                       placeholder="ä¾‹: 34 ã¾ãŸã¯ 9999ï¼ˆå…¨ã¦ï¼‰">
                            </td>
                            <td>
                                <select id="csvFile_{{ room_num }}" 
                                        class="form-control csv-setting-select" 
                                        data-room-number="{{ room_num }}">
                                    <option value="words.csv" {% if room_csv_settings.get(room_num, 'words.csv') == 'words.csv' %}selected{% endif %}>
                                        words.csv (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)
                                    </option>
                                    <!-- å‹•çš„ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ  -->
                                </select>
                                <small class="form-text text-muted">
                                    ç¾åœ¨ã®è¨­å®š: <code id="current_csv_{{ room_num }}">{{ room_csv_settings.get(room_num, 'words.csv') }}</code>
                                </small>
                            </td>
                            <td>
                                <div class="btn-group-vertical btn-group-sm">
                                    <button class="btn btn-primary btn-sm save-room-setting-btn" 
                                            data-room-number="{{ room_num }}">ä¿å­˜</button>
                                    <button class="btn btn-danger btn-sm delete-room-setting-btn" 
                                            data-room-number="{{ room_num }}">å‰Šé™¤</button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </section>
</div>

<!-- ãƒªã‚»ãƒƒãƒˆç¢ºèªãƒ•ã‚©ãƒ¼ãƒ ï¼ˆéè¡¨ç¤ºï¼‰ -->
<form id="resetForm" action="{{ url_for('admin_app_info_reset') }}" method="POST" style="display: none;">
</form>

<script>
// ========================================
// 1. æœ€åˆã«é–¢æ•°ã‚’å®šç¾©ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ï¼‰
// ========================================

console.log('ğŸ”§ admin.html ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿é–‹å§‹');

// éƒ¨å±‹è¨­å®šã‚’å†èª­ã¿è¾¼ã¿ã™ã‚‹é–¢æ•°
function loadRoomSettings() {
    console.log('ğŸ”„ éƒ¨å±‹è¨­å®šã‚’å†èª­ã¿è¾¼ã¿ä¸­...');
    
    document.querySelectorAll('.csv-setting-select').forEach(select => {
        const roomNumber = select.dataset.roomNumber;
        if (!roomNumber) return;
        
        fetch('/admin/get_room_setting', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ room_number: roomNumber })
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                const csvFilename = data.csv_filename || 'words.csv';
                console.log(`ğŸ“‹ éƒ¨å±‹${roomNumber}ã®è¨­å®šèª­ã¿è¾¼ã¿: ${csvFilename}`);
                
                select.value = csvFilename;
                
                const optionExists = Array.from(select.options).some(option => option.value === csvFilename);
                if (!optionExists && csvFilename !== 'words.csv') {
                    const newOption = document.createElement('option');
                    newOption.value = csvFilename;
                    newOption.textContent = csvFilename;
                    select.appendChild(newOption);
                    select.value = csvFilename;
                    console.log(`â• æ–°ã—ã„ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¿½åŠ : ${csvFilename}`);
                }
            }
        })
        .catch(error => {
            console.error(`âŒ éƒ¨å±‹${roomNumber}ã®è¨­å®šèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:`, error);
        });
    });
}

// CSVãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’èª­ã¿è¾¼ã‚€é–¢æ•°
function loadCsvFilesList() {
    console.log('ğŸ” CSV ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§èª­ã¿è¾¼ã¿é–‹å§‹...');
    
    const container = document.getElementById('csv-files-container');
    if (container) {
        container.innerHTML = '<p class="text-info">ğŸ“‹ ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>';
    }
    
    fetch('{{ url_for("admin_list_room_csv_files") }}')
        .then(response => {
            console.log('ğŸ“¡ ãƒ¬ã‚¹ãƒãƒ³ã‚¹å—ä¿¡:', response.status);
            return response.json();
        })
        .then(data => {
            console.log('ğŸ“Š å—ä¿¡ãƒ‡ãƒ¼ã‚¿:', data);
            
            if (data.status === 'success') {
                console.log(`âœ… ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§å–å¾—æˆåŠŸ: ${data.files.length}ä»¶`);
                updateCsvFilesDisplay(data.files);
                updateCsvSelectOptions(data.files);
            } else {
                console.error('âŒ ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§å–å¾—å¤±æ•—:', data.message);
                if (container) {
                    container.innerHTML = '<p class="text-danger">âŒ ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (data.message || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼') + '</p>';
                }
            }
        })
        .catch(error => {
            console.error('âŒ ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
            if (container) {
                container.innerHTML = '<p class="text-danger">âŒ ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message + '</p>';
            }
        });
}

// CSVãƒ•ã‚¡ã‚¤ãƒ«è¡¨ç¤ºã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
function updateCsvFilesDisplay(files) {
    console.log('ğŸ”„ ãƒ•ã‚¡ã‚¤ãƒ«è¡¨ç¤ºæ›´æ–°:', files);
    
    const container = document.getElementById('csv-files-container');
    if (!container) {
        console.error('âŒ csv-files-container ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        return;
    }
    
    if (files.length === 0) {
        console.log('ğŸ“­ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãªã—');
        container.innerHTML = '<p class="text-muted">ğŸ“­ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸCSVãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
        return;
    }
    
    console.log(`ğŸ“‹ ${files.length}ä»¶ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¡¨ç¤ºä¸­...`);
    
    let html = '<div class="table-responsive"><table class="table table-sm table-striped">';
    html += '<thead class="table-dark"><tr><th>ãƒ•ã‚¡ã‚¤ãƒ«å</th><th>å˜èªæ•°</th><th>ã‚µã‚¤ã‚º</th><th>æ›´æ–°æ—¥æ™‚</th><th>æ“ä½œ</th></tr></thead><tbody>';
    
    files.forEach((file, index) => {
        const sizeKB = Math.round(file.size / 1024);
        const wordCountDisplay = file.word_count > 0 ? `${file.word_count}å•` : 'ä¸æ˜';
        
        html += '<tr>' +
                '<td><code>' + file.filename + '</code></td>' +
                '<td><span class="badge bg-primary">' + wordCountDisplay + '</span></td>' +
                '<td>' + sizeKB + ' KB</td>' +
                '<td><small>' + file.modified + '</small></td>' +
                '<td><button class="btn btn-danger btn-sm" onclick="deleteCsvFile(\'' + file.filename + '\')">å‰Šé™¤</button></td>' +
                '</tr>';
    });
    
    html += '</tbody></table></div>';
    container.innerHTML = html;
    
    console.log('âœ… ãƒ•ã‚¡ã‚¤ãƒ«è¡¨ç¤ºæ›´æ–°å®Œäº†');
}

// ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
function updateCsvSelectOptions(files) {
    console.log('ğŸ”„ CSVã‚»ãƒ¬ã‚¯ãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³æ›´æ–°:', files);
    
    const selects = document.querySelectorAll('.csv-setting-select');
    console.log(`ğŸ“‹ æ›´æ–°å¯¾è±¡ã‚»ãƒ¬ã‚¯ãƒˆæ•°: ${selects.length}`);
    
    selects.forEach((select, index) => {
        const roomNumber = select.dataset.roomNumber;
        const currentValue = select.value;
        
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä»¥å¤–ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤
        Array.from(select.options).forEach(option => {
            if (option.value !== 'words.csv') {
                option.remove();
            }
        });
        
        // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«è¿½åŠ 
        if (files && Array.isArray(files)) {
            files.forEach(file => {
                if (file.filename !== 'words.csv') {
                    const option = document.createElement('option');
                    option.value = file.filename;
                    option.textContent = file.filename;
                    select.appendChild(option);
                }
            });
        }
        
        // å…ƒã®å€¤ã‚’å¾©å…ƒ
        if (currentValue && currentValue !== '') {
            select.value = currentValue;
        }
    });
}

// CSVãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤é–¢æ•°
function deleteCsvFile(filename) {
    if (confirm('CSVãƒ•ã‚¡ã‚¤ãƒ« "' + filename + '" ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n\nâš ï¸ ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹éƒ¨å±‹ã®è¨­å®šã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã‚Šã¾ã™ã€‚')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '{{ url_for("admin_delete_room_csv", filename="_FILENAME_") }}'.replace('_FILENAME_', filename);
        
        document.body.appendChild(form);
        form.submit();
    }
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½
function initializeUserTableSort() {
    const table = document.getElementById('userTable');
    const tbody = document.getElementById('userTableBody');
    
    if (!table || !tbody) return;
    
    // ã‚½ãƒ¼ãƒˆã‚¢ã‚¤ã‚³ãƒ³ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
    document.querySelectorAll('.sort-icon').forEach(icon => {
        icon.addEventListener('click', function() {
            const column = this.dataset.column;
            const isAscending = this.classList.contains('fa-sort-up');
            
            // å…¨ã‚¢ã‚¤ã‚³ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.querySelectorAll('.sort-icon').forEach(i => {
                i.className = 'fas fa-sort sort-icon';
            });
            
            // ç¾åœ¨ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’æ›´æ–°
            this.className = `fas fa-sort-${isAscending ? 'down' : 'up'} sort-icon`;
            
            sortUserTable(column, !isAscending);
        });
    });
}

function sortUserTable(column, ascending) {
    const tbody = document.getElementById('userTableBody');
    const rows = Array.from(tbody.querySelectorAll('tr'));
    
    rows.sort((a, b) => {
        let aVal, bVal;
        
        switch(column) {
            case 'room':
                aVal = a.cells[1].textContent.trim();
                bVal = b.cells[1].textContent.trim();
                break;
            case 'name':
                aVal = a.cells[3].textContent.trim();
                bVal = b.cells[3].textContent.trim();
                break;
            case 'login':
                aVal = a.cells[4].textContent.trim();
                bVal = b.cells[4].textContent.trim();
                // æ—¥ä»˜ã®å ´åˆã¯ Date ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›
                if (aVal !== 'æœªãƒ­ã‚°ã‚¤ãƒ³') aVal = new Date(aVal);
                if (bVal !== 'æœªãƒ­ã‚°ã‚¤ãƒ³') bVal = new Date(bVal);
                break;
            default:
                return 0;
        }
        
        if (aVal < bVal) return ascending ? -1 : 1;
        if (aVal > bVal) return ascending ? 1 : -1;
        return 0;
    });
    
    // ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å†æ§‹ç¯‰
    tbody.innerHTML = '';
    rows.forEach(row => tbody.appendChild(row));
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½
function initializeUserFiltering() {
    const roomSelect = document.getElementById('roomSortSelect');
    const searchInput = document.getElementById('userSearchInput');
    
    if (roomSelect) {
        roomSelect.addEventListener('change', filterUsers);
    }
    
    if (searchInput) {
        searchInput.addEventListener('input', filterUsers);
    }
}

function filterUsers() {
    const roomSelect = document.getElementById('roomSortSelect');
    const searchInput = document.getElementById('userSearchInput');
    const tbody = document.getElementById('userTableBody');
    
    if (!tbody) return;
    
    const selectedRoom = roomSelect ? roomSelect.value : '';
    const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
    
    const rows = tbody.querySelectorAll('tr');
    
    rows.forEach(row => {
        const roomMatch = !selectedRoom || row.dataset.room === selectedRoom;
        const searchMatch = !searchTerm || 
            row.dataset.name.includes(searchTerm) || 
            row.dataset.student.includes(searchTerm);
        
        row.style.display = (roomMatch && searchMatch) ? '' : 'none';
    });
}

console.log('âœ… å…¨ã¦ã®é–¢æ•°å®šç¾©å®Œäº†');

// ========================================
// 2. DOMContentLoaded ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
// ========================================

document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸ“‹ ç®¡ç†è€…ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†');
    
    // åˆæœŸãƒ­ãƒ¼ãƒ‰æ™‚ã«CSVãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã¨ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’æ›´æ–°
    setTimeout(() => {
        console.log('ğŸ”„ åˆæœŸãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿é–‹å§‹');
        loadCsvFilesList();
        loadRoomSettings();
    }, 500);

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«æ©Ÿèƒ½åˆæœŸåŒ–
    initializeUserTableSort();
    initializeUserFiltering();

    // éƒ¨å±‹è¨­å®šä¿å­˜ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    document.querySelectorAll('.save-room-setting-btn').forEach(button => {
        button.addEventListener('click', function() {
            const roomNumber = this.dataset.roomNumber;
            const maxUnitInput = document.getElementById('maxUnit_' + roomNumber);
            const csvFileSelect = document.getElementById('csvFile_' + roomNumber);
            
            console.log(`ğŸ”§ éƒ¨å±‹è¨­å®šä¿å­˜é–‹å§‹: ${roomNumber}`);
            
            if (!maxUnitInput || !csvFileSelect) {
                alert('è¨­å®šè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚');
                console.error('âŒ è¨­å®šè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', {
                    maxUnit: !!maxUnitInput,
                    csvFile: !!csvFileSelect
                });
                return;
            }
            
            const maxUnit = maxUnitInput.value.trim();
            const csvFilename = csvFileSelect.value;
            
            console.log(`ğŸ“ ä¿å­˜ã™ã‚‹è¨­å®š:`, {
                roomNumber: roomNumber,
                maxUnit: maxUnit,
                csvFilename: csvFilename
            });

            // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–ã—ã¦é‡è¤‡å®Ÿè¡Œã‚’é˜²ã
            this.disabled = true;
            this.textContent = 'ä¿å­˜ä¸­...';

            // å˜å…ƒè¨­å®šã¨CSVãƒ•ã‚¡ã‚¤ãƒ«è¨­å®šã‚’åŒæ™‚ã«æ›´æ–°
            Promise.all([
                fetch('{{ url_for("admin_update_room_unit_setting") }}', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        room_number: roomNumber,
                        max_unit: maxUnit
                    })
                }),
                fetch('{{ url_for("admin_update_room_csv_setting") }}', {
                    method: 'POST', 
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        room_number: roomNumber,
                        csv_filename: csvFilename
                    })
                })
            ])
            .then(responses => {
                console.log('ğŸ“¡ ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å—ä¿¡:', responses.map(r => r.status));
                return Promise.all(responses.map(r => r.json()));
            })
            .then(results => {
                const unitResult = results[0];
                const csvResult = results[1];
                
                console.log('ğŸ“Š ä¿å­˜çµæœ:', { unitResult, csvResult });
                
                if (unitResult.status === 'success' && csvResult.status === 'success') {
                    alert(`âœ… éƒ¨å±‹ ${roomNumber} ã®è¨­å®šã‚’æ›´æ–°ã—ã¾ã—ãŸ:\nãƒ»æœ€å¤§å˜å…ƒ: ${maxUnit}\nãƒ»CSVãƒ•ã‚¡ã‚¤ãƒ«: ${csvFilename}`);
                    
                    // ä¿å­˜æˆåŠŸå¾Œã€ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®å€¤ã‚’å†ç¢ºèª
                    setTimeout(() => {
                        const currentValue = csvFileSelect.value;
                        console.log(`âœ… ä¿å­˜å¾Œã®é¸æŠå€¤ç¢ºèª: ${currentValue}`);
                        if (currentValue !== csvFilename) {
                            console.warn(`âš ï¸ é¸æŠå€¤ãŒå¤‰æ›´ã•ã‚Œã¦ã„ã¾ã™: ${csvFilename} -> ${currentValue}`);
                            csvFileSelect.value = csvFilename; // å¼·åˆ¶çš„ã«è¨­å®š
                        }
                        
                        // ç¾åœ¨ã®è¨­å®šè¡¨ç¤ºã‚‚æ›´æ–°
                        const currentDisplay = document.getElementById('current_csv_' + roomNumber);
                        if (currentDisplay) {
                            currentDisplay.textContent = csvFilename;
                        }
                    }, 100);
                    
                    // è¨­å®šã®å†èª­ã¿è¾¼ã¿
                    loadRoomSettings();
                } else {
                    const errorMsg = (unitResult.message || csvResult.message || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼');
                    alert('âŒ è¨­å®šã®ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + errorMsg);
                    console.error('âŒ ä¿å­˜ã‚¨ãƒ©ãƒ¼:', { unitResult, csvResult });
                }
            })
            .catch(error => {
                console.error('âŒ é€šä¿¡ã‚¨ãƒ©ãƒ¼:', error);
                alert('âŒ è¨­å®šã®ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
            })
            .finally(() => {
                this.disabled = false;
                this.textContent = 'ä¿å­˜';
            });
        });
    });

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    document.querySelectorAll('.delete-user-btn').forEach(button => {
        button.addEventListener('click', function() {
            const userId = this.dataset.userId;
            const username = this.dataset.username;
            const roomNumber = this.dataset.room;

            if (confirm(`ãƒ¦ãƒ¼ã‚¶ãƒ¼ "${username}" (éƒ¨å±‹: ${roomNumber}, ID: ${userId}) ã‚’æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n\nâš ï¸ ã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚\nâš ï¸ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å­¦ç¿’å±¥æ­´ã‚‚å®Œå…¨ã«å‰Šé™¤ã•ã‚Œã¾ã™ã€‚`)) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '{{ url_for("admin_delete_user", user_id=0) }}'.replace('0', userId);

                document.body.appendChild(form);
                form.submit();
            }
        });
    });

    // éƒ¨å±‹è¨­å®šå‰Šé™¤ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    document.querySelectorAll('.delete-room-setting-btn').forEach(button => {
        button.addEventListener('click', function() {
            const roomNumber = this.dataset.roomNumber;

            if (confirm('éƒ¨å±‹ "' + roomNumber + '" ã®è¨­å®šã‚’æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n\nâš ï¸ ã“ã®éƒ¨å±‹ã«å±ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¨­å®šã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã‚Šã¾ã™ã€‚\nâš ï¸ ã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚')) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '{{ url_for("admin_delete_room_setting", room_number="_ROOM_NUMBER_") }}'.replace('_ROOM_NUMBER_', roomNumber);

                document.body.appendChild(form);
                form.submit();
            }
        });
    });
});

console.log('ğŸ‰ admin.html ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿å®Œäº†');

function confirmDeleteUser(userId, username, roomNumber, studentId) {
    const message = `ä»¥ä¸‹ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n\nã‚¢ã‚«ã‚¦ãƒ³ãƒˆå: ${username}\néƒ¨å±‹ç•ªå·: ${roomNumber}\nå‡ºå¸­ç•ªå·: ${studentId}\n\nâ€»ã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚`;
    
    if (confirm(message)) {
        // å‰Šé™¤ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆã—ã¦é€ä¿¡
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/admin/delete_user/${userId}`;
        
        // CSRFãƒˆãƒ¼ã‚¯ãƒ³ãŒã‚ã‚‹å ´åˆã¯è¿½åŠ 
        // const csrfToken = document.querySelector('meta[name=csrf-token]');
        // if (csrfToken) {
        //     const csrfInput = document.createElement('input');
        //     csrfInput.type = 'hidden';
        //     csrfInput.name = 'csrf_token';
        //     csrfInput.value = csrfToken.getAttribute('content');
        //     form.appendChild(csrfInput);
        // }
        
        document.body.appendChild(form);
        form.submit();
    }
}
</script>

<style>
.admin-panel {
    background-color: #f9f9f9;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
    border: 1px solid #eee;
}

.download-buttons {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-bottom: 20px;
}

.btn-group-vertical .btn {
    margin-bottom: 2px;
}

/* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ãªãƒ†ãƒ¼ãƒ–ãƒ«ã‚³ãƒ³ãƒ†ãƒŠ */
.scrollable-table-container {
    max-height: 400px;
    overflow-y: auto;
    border: 1px solid #dee2e6;
    border-radius: 0.375rem;
    margin-bottom: 1rem;
}

.scrollable-table-container .table {
    margin-bottom: 0;
}

/* å›ºå®šãƒ˜ãƒƒãƒ€ãƒ¼ */
.sticky-header {
    position: sticky;
    top: 0;
    z-index: 10;
    background-color: #343a40 !important;
}

/* ãƒ†ãƒ¼ãƒ–ãƒ«åˆ¶å¾¡è¦ç´  */
.table-controls {
    background-color: #f8f9fa;
    padding: 15px;
    border-radius: 0.375rem;
    border: 1px solid #dee2e6;
}

.table-controls label {
    font-weight: 600;
    margin-bottom: 5px;
    display: block;
}

/* ã‚½ãƒ¼ãƒˆã‚¢ã‚¤ã‚³ãƒ³ */
.sort-icon {
    margin-left: 5px;
    opacity: 0.7;
    transition: opacity 0.2s;
}

.sort-icon:hover {
    opacity: 1;
}

/* ãƒãƒƒã‚¸ã‚¹ã‚¿ã‚¤ãƒ« */
.badge {
    font-size: 0.8em;
}

/* ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œã®ãƒ›ãƒãƒ¼åŠ¹æœ */
#userTableBody tr:hover {
    background-color: #f8f9fa;
}

/* å‰Šé™¤ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«çµ±ä¸€ */
.delete-user-btn {
    font-size: 0.8rem;
    padding: 0.25rem 0.5rem;
}

@media (max-width: 767px) {
    .download-buttons {
        flex-direction: column;
    }
    
    .download-buttons .btn {
        width: 100%;
        margin-bottom: 5px;
    }
    
    .btn-group-vertical {
        display: flex;
        flex-direction: column;
        gap: 2px;
    }
    
    .btn-group-vertical .btn {
        font-size: 0.7rem;
        padding: 4px 8px;
    }
    
    .scrollable-table-container {
        max-height: 300px;
    }
    
    .table-controls .row {
        margin-bottom: 0;
    }
    
    .table-controls .col-md-6 {
        margin-bottom: 10px;
    }
    
    /* ã‚¹ãƒãƒ›ã§ã®ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤ºæ”¹å–„ */
    .table {
        font-size: 0.8rem;
    }
    
    .table th,
    .table td {
        padding: 0.3rem;
        white-space: nowrap;
    }
}
</style>
{% endblock %}